<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FisioMetrics - Dashboard Klinis</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <script>
        // Konfigurasi warna baru dari palet
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-purple': '#8E7DBE',
                        'brand-teal': '#A6D6D6',
                        'brand-pink': '#F7CFD8',
                        'brand-yellow': '#F4F8D3',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F4F8D3; /* Latar Belakang Utama: Kuning Pucat */
        }
        /* Transisi halaman */
        .page { display: none; }
        .page.active {
            display: block;
            animation: fadeIn 0.4s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Tombol radio kustom */
        .custom-radio {
            min-width: 1.25em; width: 1.25em; height: 1.25em;
            border: 2px solid #D1D5DB; border-radius: 9999px; /* Sepenuhnya tumpul */
            display: inline-block; position: relative; cursor: pointer;
            transition: all 0.2s ease;
        }
        .custom-radio:checked { border-color: #8E7DBE; background-color: #8E7DBE; }
        .custom-radio:checked::after {
            content: ''; width: 0.5em; height: 0.5em;
            border-radius: 9999px; background: white;
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
        }
        /* Slider kustom */
        input[type=range].dynamic-slider::-webkit-slider-runnable-track {
            height: 0.75rem; border-radius: 9999px; transition: background 0.3s ease;
        }
        input[type=range].dynamic-slider::-moz-range-track {
            height: 0.75rem; border-radius: 9999px; transition: background 0.3s ease;
        }
        /* Progress Bar */
        .progress-bar-container {
            width: 100%; background-color: #e5e7eb;
            border-radius: 9999px; overflow: hidden; height: 10px;
        }
        .progress-bar {
            height: 100%; background-color: #8E7DBE;
            width: 0%; border-radius: 9999px;
            transition: width 0.4s ease-in-out;
        }
        /* Sidebar custom scrollbar */
        .sidebar-scroll::-webkit-scrollbar { width: 4px; }
        .sidebar-scroll::-webkit-scrollbar-track { background: transparent; }
        .sidebar-scroll::-webkit-scrollbar-thumb { background: #6B5E9C; border-radius: 20px; }

        /* Gaya untuk kartu pilihan interaktif (ODI & Barthel) */
        .interactive-option-card {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .interactive-option-card:hover {
            border-color: #C0B6E6;
            background-color: #F3F1F9;
        }
        .interactive-option-card.selected {
            border-color: #8E7DBE;
            background-color: #E4E0F2;
            box-shadow: 0 4px 14px 0 rgb(142 125 190 / 15%);
        }
        .interactive-option-card .radio-placeholder {
            width: 1.25em; height: 1.25em; border: 2px solid #9ca3af;
            border-radius: 9999px; flex-shrink: 0; margin-right: 0.75rem;
            display: flex; align-items: center; justify-content: center;
        }
        .interactive-option-card.selected .radio-placeholder {
            border-color: #8E7DBE; background-color: #8E7DBE;
        }
        .interactive-option-card.selected .radio-placeholder svg {
            display: block;
        }
        /* Detail result view */
        #resultDetails {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="flex h-screen bg-brand-yellow">
        <!-- SIDEBAR -->
        <aside id="sidebar" class="w-64 bg-brand-purple text-white flex-shrink-0 flex flex-col transition-all duration-300 ease-in-out fixed lg:relative lg:translate-x-0 -translate-x-full z-40 h-full">
            <!-- Logo -->
            <div class="flex items-center justify-center h-20 border-b border-white/20">
                <i data-feather="hexagon" class="text-white/80"></i>
                <h1 class="text-2xl font-bold ml-3 text-white">FisioMetrics</h1>
            </div>
            <!-- Navigation -->
            <nav class="flex-1 px-4 py-6 space-y-2 sidebar-scroll overflow-y-auto">
                <a href="#dashboard" class="nav-link active" data-page="dashboardPage">
                    <i data-feather="home"></i><span>Dashboard</span>
                </a>
                <p class="px-4 pt-4 pb-2 text-xs font-semibold text-white/50 uppercase tracking-wider">Alat Ukur</p>
                <a href="#pain" class="nav-link" data-page="painPage">
                    <i data-feather="activity"></i><span>Pengukuran Nyeri</span>
                </a>
                <a href="#rom" class="nav-link" data-page="romPage">
                    <i data-feather="move"></i><span>Range of Motion</span>
                </a>
                 <a href="#ugo-fisch" class="nav-link" data-page="ugoFischPage">
                    <i data-feather="meh"></i><span>Skala Ugo Fisch</span>
                </a>
                <a href="#spadi" class="nav-link" data-page="spadiPage">
                    <i data-feather="shield"></i><span>Skala SPADI</span>
                </a>
                <a href="#fadi" class="nav-link" data-page="fadiPage">
                    <i data-feather="crosshair"></i><span>Skala FADI</span>
                </a>
                <a href="#odi" class="nav-link" data-page="odiPage">
                    <i data-feather="bar-chart-2"></i><span>Skala ODI</span>
                </a>
                <a href="#barthel" class="nav-link" data-page="barthelPage">
                    <i data-feather="check-square"></i><span>Indeks Barthel</span>
                </a>
                <a href="#6mwt" class="nav-link" data-page="sixMWTPage">
                    <i data-feather="watch"></i><span>6-Minute Walk Test</span>
                </a>
            </nav>
            <!-- Credits -->
            <div class="p-4 border-t border-white/20">
                <div class="flex items-center">
                    <div class="p-2 bg-white/10 rounded-full">
                        <i data-feather="award" class="w-6 h-6 text-brand-pink"></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-xs text-white/70">Diciptakan oleh:</p>
                        <p class="text-sm font-semibold text-white leading-tight">Andhika Ramadhani P., A.Md.Kes</p>
                        <p class="text-xs text-white/60 mt-1">Poltekkes Kemenkes Surakarta<br>Jurusan Fisioterapi</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white/50 backdrop-blur-sm shadow-sm z-20">
                <div class="flex items-center justify-between p-4">
                    <button id="menu-button" class="lg:hidden text-slate-600">
                        <i data-feather="menu" class="w-6 h-6"></i>
                    </button>
                    <h2 id="pageTitle" class="text-xl font-bold text-slate-800">Dashboard</h2>
                    <input type="text" id="patientName" placeholder="Nama Pasien..." class="hidden sm:block w-full max-w-xs px-4 py-2 border border-slate-300 rounded-xl focus:ring-2 focus:ring-brand-purple focus:border-brand-purple transition shadow-sm">
                </div>
            </header>

            <!-- Content Area -->
            <main class="flex-1 overflow-x-hidden overflow-y-auto p-4 sm:p-6 lg:p-8">
                <div id="pageContainer">
                    <!-- DASHBOARD HOME PAGE -->
                    <div id="dashboardPage" class="page active"></div>
                    
                    <!-- Other pages will be injected here -->
                    <div id="painPage" class="page"></div>
                    <div id="romPage" class="page"></div>
                    <div id="spadiPage" class="page"></div>
                    <div id="fadiPage" class="page"></div>
                    <div id="odiPage" class="page"></div>
                    <div id="barthelPage" class="page"></div>
                    <div id="sixMWTPage" class="page"></div>
                    <div id="ugoFischPage" class="page"></div>

                </div>
            </main>
        </div>
    </div>

    <!-- RESULT MODAL -->
    <div id="resultModal" class="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full transform transition-all scale-95 flex flex-col max-h-[90vh]" id="resultModalContent">
            <!-- Modal Header (Not scrollable) -->
            <div class="p-6 text-center border-b border-slate-200 flex-shrink-0">
                <div id="resultIcon" class="mx-auto mb-3"></div>
                <h3 class="text-2xl font-bold text-slate-800" id="resultTitle"></h3>
                <p class="text-slate-500 mt-1">Untuk pasien: <strong id="resultPatientName" class="text-slate-700"></strong></p>
            </div>

            <!-- Scrollable Modal Body -->
            <div class="p-6 flex-grow overflow-y-auto">
                <div id="resultBody" class="mb-6"></div>
                <div id="resultDetails" class="text-left"></div>
            </div>

            <!-- Modal Footer (Not scrollable) -->
            <div class="p-6 border-t border-slate-200 bg-slate-50 rounded-b-3xl flex-shrink-0">
                <div class="flex gap-4">
                     <button id="detailsButton" class="btn-secondary">Lihat Rincian</button>
                     <button onclick="closeModal()" class="btn-primary">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reusable CSS via @apply -->
    <style>
        .nav-link { @apply flex items-center px-4 py-3 rounded-xl transition-colors duration-200 hover:bg-white/10 text-white/80; }
        .nav-link.active { @apply bg-white/20 text-white font-semibold shadow-lg; }
        .nav-link i { @apply w-5 h-5 mr-3; }
        .tool-page-container { @apply bg-white p-6 sm:p-8 rounded-2xl shadow-xl; }
        .tool-title { @apply text-3xl font-bold text-center mb-8 text-slate-800; }
        .btn-primary { @apply w-full bg-brand-purple text-white font-semibold py-3 px-6 rounded-xl hover:opacity-90 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-brand-purple/50 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5; }
        .btn-secondary { @apply w-full bg-slate-200 text-slate-800 font-semibold py-3 px-6 rounded-xl hover:bg-slate-300 transition-colors duration-300 focus:outline-none focus:ring-4 focus:ring-slate-300; }
        .form-section { @apply mb-6 p-5 border border-slate-200/80 rounded-2xl transition-shadow hover:shadow-lg; }
        .input-field { @apply w-full px-4 py-2 border border-slate-300 rounded-xl bg-slate-50 focus:bg-white focus:ring-2 focus:ring-brand-purple focus:border-brand-purple transition shadow-sm; }
        .btn-nav { @apply bg-white text-slate-700 font-semibold py-2.5 px-6 rounded-xl border border-slate-300 hover:bg-slate-100 transition-all; }
        .explanation-card { @apply bg-white p-5 rounded-2xl shadow-lg flex items-center transition-all duration-300 cursor-pointer hover:shadow-xl hover:-translate-y-1; }
        .explanation-card .icon-container { @apply p-3 rounded-full mr-4; }
    </style>

    <script>
    // ===================================
    // SCRIPT UTAMA APLIKASI
    // ===================================
    const pageContents = {
        dashboardPage: `
            <h3 class="text-3xl font-bold text-slate-800 mb-2">Selamat Datang di FisioMetrics!</h3>
            <p class="text-slate-600 mb-8">Aplikasi ini menyediakan berbagai alat ukur standar fisioterapi untuk membantu asesmen Anda. Pilih alat ukur dari menu di sebelah kiri.</p>
            <div class="space-y-5">
                <!-- Penjelasan Pemeriksaan -->
                <div class="explanation-card" onclick="navigateTo('painPage')">
                    <div class="icon-container bg-brand-pink/50 text-pink-800"><i data-feather="activity"></i></div>
                    <div><h4 class="font-bold text-slate-800">Pengukuran Nyeri (NRS)</h4><p class="text-sm text-slate-600">Mengukur intensitas nyeri pasien pada kondisi diam, tekan, dan gerak menggunakan skala 0-10.</p></div>
                </div>
                 <div class="explanation-card" onclick="navigateTo('romPage')">
                    <div class="icon-container bg-brand-teal/50 text-teal-800"><i data-feather="move"></i></div>
                    <div><h4 class="font-bold text-slate-800">Range of Motion (ROM)</h4><p class="text-sm text-slate-600">Mencatat lingkup gerak sendi aktif dan pasif dalam derajat untuk berbagai sendi dan gerakan.</p></div>
                </div>
                <div class="explanation-card" onclick="navigateTo('ugoFischPage')">
                    <div class="icon-container bg-brand-pink/50 text-pink-800"><i data-feather="meh"></i></div>
                    <div><h4 class="font-bold text-slate-800">Skala Ugo Fisch</h4><p class="text-sm text-slate-600">Menilai fungsi nervus fasialis untuk kasus Bell's Palsy berdasarkan persentase gerakan.</p></div>
                </div>
                 <div class="explanation-card" onclick="navigateTo('spadiPage')">
                    <div class="icon-container bg-brand-purple/20 text-brand-purple"><i data-feather="shield"></i></div>
                    <div><h4 class="font-bold text-slate-800">Skala SPADI</h4><p class="text-sm text-slate-600">Mengukur tingkat nyeri dan disabilitas pada masalah bahu (Shoulder Pain and Disability Index).</p></div>
                </div>
                 <div class="explanation-card" onclick="navigateTo('fadiPage')">
                    <div class="icon-container bg-brand-pink/50 text-pink-800"><i data-feather="crosshair"></i></div>
                    <div><h4 class="font-bold text-slate-800">Skala FADI</h4><p class="text-sm text-slate-600">Mengukur tingkat disabilitas terkait kaki dan pergelangan kaki (Foot and Ankle Disability Index).</p></div>
                </div>
                <div class="explanation-card" onclick="navigateTo('odiPage')">
                    <div class="icon-container bg-brand-teal/50 text-teal-800"><i data-feather="bar-chart-2"></i></div>
                    <div><h4 class="font-bold text-slate-800">Skala ODI</h4><p class="text-sm text-slate-600">Mengukur tingkat disabilitas fungsional akibat nyeri punggung bawah (Oswestry Disability Index).</p></div>
                </div>
                 <div class="explanation-card" onclick="navigateTo('barthelPage')">
                    <div class="icon-container bg-brand-purple/20 text-brand-purple"><i data-feather="check-square"></i></div>
                    <div><h4 class="font-bold text-slate-800">Indeks Barthel</h4><p class="text-sm text-slate-600">Menilai tingkat kemandirian pasien dalam melakukan aktivitas kehidupan sehari-hari.</p></div>
                </div>
                <div class="explanation-card" onclick="navigateTo('sixMWTPage')">
                    <div class="icon-container bg-brand-pink/50 text-pink-800"><i data-feather="watch"></i></div>
                    <div><h4 class="font-bold text-slate-800">6-Minute Walk Test (6MWT)</h4><p class="text-sm text-slate-600">Mengukur toleransi dan kapasitas fungsional pasien melalui tes berjalan selama 6 menit.</p></div>
                </div>
            </div>
            `,
        painPage: `
            <div class="tool-page-container">
                <h2 class="tool-title">Pengukuran Nyeri (NRS)</h2>
                <div class="space-y-8">
                    <div>
                        <label for="painRest" class="block text-lg font-medium text-slate-700 mb-3">Nyeri Diam (Saat tidak bergerak)</label>
                        <div class="flex items-center gap-4"><span class="text-3xl font-bold text-brand-purple w-16 text-center" id="painRestValue">5</span><input type="range" id="painRest" min="0" max="10" value="5" class="w-full dynamic-slider" oninput="updatePainValue('painRest', 'painRestValue')"></div>
                    </div>
                    <div>
                        <label for="painPressure" class="block text-lg font-medium text-slate-700 mb-3">Nyeri Tekan (Saat area ditekan)</label>
                        <div class="flex items-center gap-4"><span class="text-3xl font-bold text-brand-purple w-16 text-center" id="painPressureValue">5</span><input type="range" id="painPressure" min="0" max="10" value="5" class="w-full dynamic-slider" oninput="updatePainValue('painPressure', 'painPressureValue')"></div>
                    </div>
                    <div>
                        <label for="painMovement" class="block text-lg font-medium text-slate-700 mb-3">Nyeri Gerak (Saat digerakkan)</label>
                        <div class="flex items-center gap-4"><span class="text-3xl font-bold text-brand-purple w-16 text-center" id="painMovementValue">5</span><input type="range" id="painMovement" min="0" max="10" value="5" class="w-full dynamic-slider" oninput="updatePainValue('painMovement', 'painMovementValue')"></div>
                    </div>
                </div>
                <div class="flex gap-4 mt-10"><button onclick="navigateTo('dashboardPage')" class="btn-secondary">Kembali ke Dashboard</button><button onclick="showPainResult()" class="btn-primary">Simpan Hasil</button></div>
            </div>`,
        romPage: `
            <div class="tool-page-container">
                <h2 class="tool-title">Pemeriksaan Range of Motion (ROM)</h2>
                <div id="romForm" class="grid grid-cols-1 md:grid-cols-2 gap-6 items-end">
                    <div>
                        <label for="romJoint" class="block text-sm font-medium text-slate-700 mb-1">Sendi</label>
                        <select id="romJoint" class="input-field">
                            <option>Bahu</option><option>Siku</option><option>Pergelangan Tangan</option><option>Panggul</option><option>Lutut</option><option>Pergelangan Kaki</option>
                        </select>
                    </div>
                    <div>
                        <label for="romMovement" class="block text-sm font-medium text-slate-700 mb-1">Gerakan</label>
                        <select id="romMovement" class="input-field">
                            <option>Fleksi</option><option>Ekstensi</option><option>Abduksi</option><option>Adduksi</option><option>Rotasi Internal</option><option>Rotasi Eksternal</option>
                        </select>
                    </div>
                    <div>
                        <label for="romActive" class="block text-sm font-medium text-slate-700 mb-1">ROM Aktif (°)</label>
                        <input type="number" id="romActive" class="input-field" placeholder="cth: 90">
                    </div>
                    <div>
                        <label for="romPassive" class="block text-sm font-medium text-slate-700 mb-1">ROM Pasif (°)</label>
                        <input type="number" id="romPassive" class="input-field" placeholder="cth: 100">
                    </div>
                    <div class="md:col-span-2">
                        <button type="button" onclick="addRomMovement()" class="w-full bg-brand-teal text-white font-semibold py-2.5 px-6 rounded-xl hover:opacity-90 transition-all focus:outline-none focus:ring-4 focus:ring-brand-teal/50 shadow-lg">Tambah Gerakan</button>
                    </div>
                </div>
                <div class="mt-8">
                    <h3 class="font-semibold text-lg mb-4">Daftar Pengukuran ROM:</h3>
                    <div id="romListContainer" class="bg-slate-50 p-4 rounded-xl min-h-[100px]"><p id="romEmptyState" class="text-slate-500 text-center">Belum ada pengukuran yang ditambahkan.</p><div id="romList" class="space-y-2"></div></div>
                </div>
                <div class="flex gap-4 mt-8"><button onclick="navigateTo('dashboardPage')" class="btn-secondary">Kembali ke Dashboard</button><button onclick="showRomResult()" class="btn-primary">Simpan Hasil</button></div>
            </div>`,
        spadiPage: `
            <div class="tool-page-container">
                <h2 class="tool-title">Shoulder Pain and Disability Index (SPADI)</h2>
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-slate-600">Progres</span>
                        <span id="spadiProgressText" class="text-sm font-bold text-brand-purple">Langkah 1 dari 13</span>
                    </div>
                    <div class="progress-bar-container"><div id="spadiProgressBar" class="progress-bar"></div></div>
                </div>
                <div id="spadiWizardContainer">
                    <!-- Wizard content for SPADI will be injected here -->
                </div>
            </div>`,
        ugoFischPage: `
            <div class="tool-page-container">
                <h2 class="tool-title">Skala Ugo Fisch</h2>
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-slate-600">Progres</span>
                        <span id="ugoFischProgressText" class="text-sm font-bold text-brand-purple">Langkah 1 dari 5</span>
                    </div>
                    <div class="progress-bar-container"><div id="ugoFischProgressBar" class="progress-bar"></div></div>
                </div>
                <div id="ugoFischWizardContainer">
                    <!-- Wizard content for Ugo Fisch will be injected here -->
                </div>
            </div>`,
        fadiPage: `
            <div id="fadiSelectionPage" class="tool-page-container">
                <h2 class="tool-title">Pilih Jenis Skala FADI</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div onclick="initFadiWizard('fadi')" class="interactive-option-card flex-col h-40 justify-center text-center">
                        <i data-feather="clipboard" class="w-12 h-12 text-brand-purple mb-2"></i>
                        <h3 class="font-bold text-lg">FADI</h3>
                        <p class="text-sm text-slate-500">26 Pertanyaan Umum</p>
                    </div>
                    <div onclick="initFadiWizard('sport')" class="interactive-option-card flex-col h-40 justify-center text-center">
                         <i data-feather="zap" class="w-12 h-12 text-brand-teal mb-2"></i>
                        <h3 class="font-bold text-lg">FADI Sport</h3>
                        <p class="text-sm text-slate-500">8 Pertanyaan Olahraga</p>
                    </div>
                </div>
                 <div class="mt-8"><button onclick="navigateTo('dashboardPage')" class="btn-secondary w-full">Kembali ke Dashboard</button></div>
            </div>
            <div id="fadiWizardPage" class="hidden">
                 <div class="tool-page-container">
                    <h2 id="fadiWizardTitle" class="tool-title"></h2>
                    <div class="mb-8">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm font-medium text-slate-600">Progres</span>
                            <span id="fadiProgressText" class="text-sm font-bold text-brand-purple"></span>
                        </div>
                        <div class="progress-bar-container"><div id="fadiProgressBar" class="progress-bar"></div></div>
                    </div>
                    <div id="fadiWizardContainer">
                        <!-- Wizard content for FADI will be injected here -->
                    </div>
                </div>
            </div>
            `,
        odiPage: `
            <div class="tool-page-container">
                <h2 class="tool-title">Oswestry Disability Index (ODI)</h2>
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-slate-600">Progres</span>
                        <span id="odiProgressText" class="text-sm font-bold text-brand-purple">Langkah 1 dari 10</span>
                    </div>
                    <div class="progress-bar-container"><div id="odiProgressBar" class="progress-bar"></div></div>
                </div>
                <div id="odiWizardContainer">
                    <!-- Wizard content for ODI will be injected here -->
                </div>
            </div>`,
        barthelPage: `
            <div class="tool-page-container">
                <h2 class="tool-title">Indeks Barthel</h2>
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-slate-600">Progres</span>
                        <span id="barthelProgressText" class="text-sm font-bold text-brand-purple">Langkah 1 dari 10</span>
                    </div>
                    <div class="progress-bar-container"><div id="barthelProgressBar" class="progress-bar"></div></div>
                </div>
                <div id="barthelWizardContainer">
                    <!-- Wizard content for Barthel will be injected here -->
                </div>
            </div>`,
        sixMWTPage: `
             <div class="tool-page-container">
                <h2 class="tool-title">6-Minute Walk Test (6MWT)</h2>
                <div class="bg-slate-800 text-white p-6 rounded-2xl shadow-lg mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="text-center">
                            <p class="text-slate-400 text-sm">WAKTU (Maks. 6 Menit)</p>
                            <div id="stopwatchDisplay" class="text-6xl font-bold tracking-tighter">00:00</div>
                            <div class="flex justify-center gap-4 mt-4">
                                <button id="startStopBtn" onclick="startStopwatch()" class="w-32 justify-center inline-flex items-center bg-brand-purple text-white font-semibold py-2 px-5 rounded-xl hover:opacity-90 transition-all duration-300 shadow-md">
                                    <i data-feather="play" class="mr-2"></i>Mulai
                                </button>
                                <button onclick="resetStopwatch()" class="w-32 justify-center inline-flex items-center bg-slate-600 text-slate-200 font-semibold py-2 px-5 rounded-xl hover:bg-slate-700 transition-colors duration-300">
                                    <i data-feather="rotate-ccw" class="mr-2"></i>Reset
                                </button>
                            </div>
                        </div>
                        <div class="text-center">
                             <p class="text-slate-400 text-sm">PUTARAN</p>
                            <div class="flex items-center justify-center gap-6">
                                <p id="lapCount" class="text-7xl font-extrabold">0</p>
                                <button id="lapButton" onclick="incrementLap()" class="w-24 h-24 bg-brand-teal text-white rounded-full flex items-center justify-center shadow-lg hover:opacity-90 transition transform hover:scale-105 active:scale-95 disabled:bg-slate-500 disabled:cursor-not-allowed" disabled>
                                    <i data-feather="plus" class="w-10 h-10"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h3 class="font-semibold text-lg mb-4 text-center">Data & Hasil Tes</h3>
                     <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-5">
                        <div class="sm:col-span-2">
                            <label for="distance6MWT" class="block text-sm font-semibold text-slate-700 mb-1">Jarak Tempuh (meter)</label>
                            <input type="number" id="distance6MWT" class="input-field" placeholder="Contoh: 450">
                        </div>
                        <div>
                            <label for="rpeStart" class="block text-sm font-semibold text-slate-700 mb-1">RPE Awal (Borg 6-20)</label>
                            <input type="number" id="rpeStart" class="input-field" min="6" max="20">
                        </div>
                        <div>
                            <label for="rpeEnd" class="block text-sm font-semibold text-slate-700 mb-1">RPE Akhir (Borg 6-20)</label>
                            <input type="number" id="rpeEnd" class="input-field" min="6" max="20">
                        </div>
                        <div>
                            <label for="dyspneaStart" class="block text-sm font-semibold text-slate-700 mb-1">Sesak Napas Awal (Borg 0-10)</label>
                            <input type="number" id="dyspneaStart" class="input-field" min="0" max="10">
                        </div>
                        <div>
                            <label for="dyspneaEnd" class="block text-sm font-semibold text-slate-700 mb-1">Sesak Napas Akhir (Borg 0-10)</label>
                            <input type="number" id="dyspneaEnd" class="input-field" min="0" max="10">
                        </div>
                         <div>
                            <label for="spo2Start" class="block text-sm font-semibold text-slate-700 mb-1">SpO2 Awal (%) <span class="text-xs text-slate-500">(Opsional)</span></label>
                            <input type="number" id="spo2Start" class="input-field" min="0" max="100">
                        </div>
                        <div>
                            <label for="spo2End" class="block text-sm font-semibold text-slate-700 mb-1">SpO2 Akhir (%) <span class="text-xs text-slate-500">(Opsional)</span></label>
                            <input type="number" id="spo2End" class="input-field" min="0" max="100">
                        </div>
                        <div class="sm:col-span-2">
                            <label for="terminationReason" class="block text-sm font-semibold text-slate-700 mb-1">Alasan Penghentian Dini <span class="text-xs text-slate-500">(Opsional)</span></label>
                            <textarea id="terminationReason" class="input-field" rows="2"></textarea>
                        </div>
                    </div>
                </div>

                <div class="flex gap-4 mt-8"><button onclick="navigateTo('dashboardPage')" class="btn-secondary">Kembali ke Dashboard</button><button onclick="show6MWTResult()" class="btn-primary">Simpan Hasil</button></div>
            </div>`,
    };
    
    // --- GLOBAL STATE ---
    let romEntries = [];
    let odiAnswers = [], currentOdiStep = 0;
    let barthelAnswers = [], currentBarthelStep = 0;
    let spadiAnswers = [], currentSpadiStep = 0;
    let fadiAnswers = [], currentFadiStep = 0, currentFadiType = '';
    let ugoFischAnswers = [], currentUgoFischStep = 0;
    let lapCounter = 0;

    // --- LOGIKA NAVIGASI ---
    function navigateTo(pageId) {
        if (pageId !== 'dashboardPage' && document.getElementById(pageId).innerHTML === '') {
            document.getElementById(pageId).innerHTML = pageContents[pageId];
        }
        
        if (pageId === 'ugoFischPage') initUgoFischWizard();
        if (pageId === 'spadiPage') initSpadiWizard();
        if (pageId === 'fadiPage') {
            document.getElementById('fadiSelectionPage').style.display = 'block';
            document.getElementById('fadiWizardPage').style.display = 'none';
        }
        if (pageId === 'odiPage') initOdiWizard();
        if (pageId === 'barthelPage') initBarthelWizard();
        if (pageId === 'painPage') ['painRest', 'painPressure', 'painMovement'].forEach(id => updatePainValue(id, `${id}Value`));
        if (pageId === 'romPage') { romEntries = []; renderRomList(); }
        if (pageId === 'sixMWTPage') { lapCounter = 0; }
        
        if (pageId === 'dashboardPage') {
            document.getElementById('dashboardPage').innerHTML = pageContents.dashboardPage;
        }

        feather.replace();

        document.querySelectorAll('#pageContainer .page').forEach(page => page.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');

        const navLinks = document.querySelectorAll('.nav-link');
        navLinks.forEach(link => link.classList.remove('active'));
        const activeLink = document.querySelector(`.nav-link[data-page="${pageId}"]`);
        if (activeLink) {
            activeLink.classList.add('active');
            document.getElementById('pageTitle').textContent = activeLink.querySelector('span').textContent;
        } else {
             document.getElementById('pageTitle').textContent = 'Dashboard';
        }

        document.getElementById('sidebar').classList.add('-translate-x-full');
    }

    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const pageId = link.dataset.page;
            navigateTo(pageId);
        });
    });

    document.getElementById('menu-button').addEventListener('click', () => {
        document.getElementById('sidebar').classList.toggle('-translate-x-full');
    });
    
    // --- KONTEN & KALKULASI ---
    const ugoFischItems = [
        { area: 'Dahi', test: 'Mengerutkan dahi', options: [{text: 'Normal', score: 100}, {text: 'Berkurang', score: 75}, {text: 'Sedikit', score: 30}, {text: 'Tidak ada', score: 0}] },
        { area: 'Mata', test: 'Menutup mata', options: [{text: 'Sempurna', score: 100}, {text: 'Tidak sempurna', score: 50}, {text: 'Tidak ada gerakan', score: 0}] },
        { area: 'Hidung', test: 'Mengerutkan hidung', options: [{text: 'Normal', score: 100}, {text: 'Berkurang', score: 50}, {text: 'Tidak ada', score: 0}] },
        { area: 'Mulut', test: 'Menyeringai / Menunjukkan gigi', options: [{text: 'Normal', score: 100}, {text: 'Asimetris sedang', score: 50}, {text: 'Asimetris berat', score: 0}] },
        { area: 'Bibir', test: 'Mencucu / Bersiul', options: [{text: 'Normal', score: 100}, {text: 'Berkurang', score: 50}, {text: 'Tidak ada', score: 0}] },
    ];
    const fadiOptions = [
        { text: 'Tidak ada kesulitan sama sekali', score: 4 }, { text: 'Kesulitan ringan', score: 3 }, { text: 'Kesulitan sedang', score: 2 }, { text: 'Kesulitan berat', score: 1 }, { text: 'Tidak bisa melakukan', score: 0 },
    ];
    const fadiItems = [
        { type: 'fadi', question: 'Berdiri' }, { type: 'fadi', question: 'Berjalan di permukaan rata' }, { type: 'fadi', question: 'Berjalan di permukaan tidak rata' }, { type: 'fadi', question: 'Berjalan menanjak' }, { type: 'fadi', question: 'Berjalan menurun' }, { type: 'fadi', question: 'Naik tangga' }, { type: 'fadi', question: 'Turun tangga' }, { type: 'fadi', question: 'Tidur' }, { type: 'fadi', question: 'Aktivitas sehari-hari biasa' }, { type: 'fadi', question: 'Aktivitas rumah tangga biasa' }, { type: 'fadi', question: 'Nyeri saat istirahat (tanpa menumpu berat)' }, { type: 'fadi', question: 'Nyeri selama aktivitas normal' }, { type: 'fadi', question: 'Nyeri pada akhir hari' }, { type: 'fadi', question: 'Nyeri saat pertama kali berjalan di pagi hari' }, { type: 'fadi', question: 'Mengalami nyeri di malam hari' }, { type: 'fadi', question: 'Perlu membatasi aktivitas rekreasi' }, { type: 'fadi', question: 'Merasa frustrasi' }, { type: 'fadi', question: 'Merasa tertekan' }, { type: 'fadi', question: 'Cemas karena masalah kaki/pergelangan kaki' }, { type: 'fadi', question: 'Perlu mengubah teknik olahraga/aktivitas' }, { type: 'fadi', question: 'Seberapa sering Anda memikirkan masalah ini?' }, { type: 'fadi', question: 'Seberapa bengkak pada akhir hari?' }, { type: 'fadi', question: 'Seberapa kaku saat pertama berjalan di pagi hari?' }, { type: 'fadi', question: 'Seberapa sering terasa akan \'menyerah\' (give way)?' }, { type: 'fadi', question: 'Seberapa tidak stabil saat di permukaan tidak rata?' }, { type: 'fadi', question: 'Seberapa kuat pergelangan kaki Anda?' },
        { type: 'sport', question: 'Berlari' }, { type: 'sport', question: 'Melompat' }, { type: 'sport', question: 'Mendarat' }, { type: 'sport', question: 'Mulai dan berhenti dengan cepat' }, { type: 'sport', question: 'Berhenti dengan cepat' }, { type: 'sport', question: 'Memotong atau mengubah arah dengan tajam' }, { type: 'sport', question: 'Kemampuan melakukan aktivitas seperti biasa' }, { type: 'sport', question: 'Kemampuan berpartisipasi dalam olahraga kompetitif' }
    ];
    const spadiItems = [
        { type: 'pain', question: 'Seberapa parah nyeri bahu Anda saat dalam kondisi terburuk?' }, { type: 'pain', question: 'Seberapa parah nyeri bahu Anda saat berbaring miring ke sisi yang sakit?' }, { type: 'pain', question: 'Seberapa parah nyeri bahu Anda saat meraih benda di rak yang tinggi?' }, { type: 'pain', question: 'Seberapa parah nyeri bahu Anda saat menyentuh bagian belakang leher?' }, { type: 'pain', question: 'Seberapa parah nyeri bahu Anda saat mendorong dengan lengan yang sakit?' },
        { type: 'disability', question: 'Seberapa besar kesulitan Anda saat mencuci rambut?' }, { type: 'disability', question: 'Seberapa besar kesulitan Anda saat mencuci punggung?' }, { type: 'disability', question: 'Seberapa besar kesulitan Anda saat mengenakan kemeja atau blus?' }, { type: 'disability', question: 'Seberapa besar kesulitan Anda saat mengenakan celana?' }, { type: 'disability', question: 'Seberapa besar kesulitan Anda saat menaruh benda di rak yang tinggi?' }, { type: 'disability', question: 'Seberapa besar kesulitan Anda saat membawa benda berat seberat 4.5 kg?' }, { type: 'disability', question: 'Seberapa besar kesulitan Anda saat mengambil benda dari saku belakang?' }, { type: 'disability', question: 'Seberapa besar kesulitan Anda saat mengeluarkan sesuatu dari mobil?' },
    ];
    const odiItems = [
            { id: 'pain_intensity', question: 'Intensitas Nyeri', options: ['Saya tidak merasakan nyeri saat ini.', 'Nyeri saat ini sangat ringan.', 'Nyeri saat ini cukup sedang.', 'Nyeri saat ini cukup berat.', 'Nyeri saat ini sangat berat.', 'Nyeri saat ini adalah yang terburuk yang tak terbayangkan.'] },
            { id: 'personal_care', question: 'Perawatan Diri', options: ['Saya bisa merawat diri sendiri tanpa menambah nyeri.', 'Saya bisa merawat diri sendiri tapi terasa nyeri.', 'Merawat diri sendiri terasa nyeri dan saya melakukannya secara perlahan dan hati-hati.', 'Saya membutuhkan bantuan, tetapi bisa melakukan sebagian besar perawatan diri.', 'Saya membutuhkan bantuan setiap hari dalam sebagian besar aspek perawatan diri.', 'Saya tidak bisa berpakaian, sulit mandi dan hanya berbaring di tempat tidur.'] },
            { id: 'lifting', question: 'Mengangkat Benda', options: ['Saya bisa mengangkat benda berat tanpa menambah nyeri.', 'Saya bisa mengangkat benda berat tapi menambah nyeri.', 'Nyeri menghalangi saya mengangkat benda berat dari lantai.', 'Saya hanya bisa mengangkat benda yang sangat ringan.', 'Saya tidak bisa mengangkat atau membawa apapun sama sekali.', ''] },
            { id: 'walking', question: 'Berjalan', options: ['Nyeri tidak menghalangi saya berjalan sejauh apapun.', 'Nyeri menghalangi saya berjalan lebih dari 1.5 km.', 'Nyeri menghalangi saya berjalan lebih dari 800 meter.', 'Nyeri menghalangi saya berjalan lebih dari 100 meter.', 'Saya hanya bisa berjalan menggunakan tongkat.', 'Saya hanya berbaring di tempat tidur dan tidak bisa berjalan sama sekali.'] },
            { id: 'sitting', question: 'Duduk', options: ['Saya bisa duduk di kursi manapun selama yang saya mau.', 'Saya hanya bisa duduk di kursi favorit saya selama yang saya mau.', 'Nyeri menghalangi saya duduk lebih dari 1 jam.', 'Nyeri menghalangi saya duduk lebih dari 30 menit.', 'Nyeri menghalangi saya duduk lebih dari 10 menit.', 'Nyeri menghalangi saya duduk sama sekali.'] },
            { id: 'standing', question: 'Berdiri', options: ['Saya bisa berdiri selama yang saya mau tanpa menambah nyeri.', 'Saya bisa berdiri selama yang saya mau tapi menambah nyeri.', 'Nyeri menghalangi saya berdiri lebih dari 1 jam.', 'Nyeri menghalangi saya berdiri lebih dari 30 menit.', 'Nyeri menghalangi saya berdiri lebih dari 10 menit.', 'Nyeri menghalangi saya berdiri sama sekali.'] },
            { id: 'sleeping', question: 'Tidur', options: ['Tidur saya tidak pernah terganggu oleh nyeri.', 'Tidur saya kadang terganggu oleh nyeri.', 'Karena nyeri, saya tidur kurang dari 6 jam.', 'Karena nyeri, saya tidur kurang dari 4 jam.', 'Karena nyeri, saya tidur kurang dari 2 jam.', 'Nyeri menghalangi saya tidur sama sekali.'] },
            { id: 'social_life', question: 'Kehidupan Sosial', options: ['Kehidupan sosial saya normal dan tidak menambah nyeri.', 'Kehidupan sosial saya normal tapi menambah nyeri.', 'Nyeri tidak berpengaruh signifikan pada kehidupan sosial saya.', 'Nyeri membatasi kehidupan sosial saya.', 'Nyeri membatasi kehidupan sosial saya hanya di rumah.', 'Saya tidak punya kehidupan sosial karena nyeri.'] },
            { id: 'traveling', question: 'Bepergian', options: ['Saya bisa bepergian kemana saja tanpa nyeri.', 'Saya bisa bepergian kemana saja tapi menambah nyeri.', 'Nyeri cukup berat tapi saya bisa bepergian untuk perjalanan 2 jam.', 'Nyeri membatasi saya untuk perjalanan kurang dari 1 jam.', 'Nyeri membatasi saya untuk perjalanan penting kurang dari 30 menit.', 'Nyeri menghalangi saya bepergian kecuali untuk berobat.'] },
            { id: 'employment', question: 'Pekerjaan/Aktivitas Rumah', options: ['Pekerjaan/aktivitas saya normal tanpa menambah nyeri.', 'Pekerjaan/aktivitas saya normal tapi menambah nyeri.', 'Saya bisa melakukan sebagian besar pekerjaan/aktivitas saya.', 'Nyeri menghalangi saya melakukan sebagian besar pekerjaan/aktivitas.', 'Nyeri menghalangi saya melakukan semua pekerjaan/aktivitas.', 'Saya tidak bisa bekerja/melakukan aktivitas sama sekali.'] },
        ];
    const barthelItems = [
            { id: 'bowels', question: 'Mengendalikan rangsang BAB (Bowel)', options: [{ text: 'Tak terkendali', score: 0 }, { text: 'Kadang tak terkendali', score: 5 }, { text: 'Terkendali', score: 10 }] },
            { id: 'bladder', question: 'Mengendalikan rangsang BAK (Bladder)', options: [{ text: 'Tak terkendali', score: 0 }, { text: 'Kadang tak terkendali', score: 5 }, { text: 'Mandiri', score: 10 }] },
            { id: 'grooming', question: 'Perawatan Diri', options: [{ text: 'Butuh bantuan', score: 0 }, { text: 'Mandiri', score: 5 }] },
            { id: 'toilet_use', question: 'Penggunaan Toilet', options: [{ text: 'Tergantung', score: 0 }, { text: 'Perlu bantuan', score: 5 }, { text: 'Mandiri', score: 10 }] },
            { id: 'feeding', question: 'Makan', options: [{ text: 'Tidak mampu', score: 0 }, { text: 'Perlu bantuan', score: 5 }, { text: 'Mandiri', score: 10 }] },
            { id: 'transfer', question: 'Berpindah (Transfer)', options: [{ text: 'Tidak mampu', score: 0 }, { text: 'Bantuan 1 orang', score: 5 }, { text: 'Bantuan minimal', score: 10 }, { text: 'Mandiri', score: 15 }] },
            { id: 'mobility', question: 'Mobilitas / Berjalan', options: [{ text: 'Immobile', score: 0 }, { text: 'Mandiri kursi roda', score: 5 }, { text: 'Berjalan bantuan 1 orang', score: 10 }, { text: 'Mandiri', score: 15 }] },
            { id: 'dressing', question: 'Berpakaian', options: [{ text: 'Tergantung', score: 0 }, { text: 'Perlu bantuan', score: 5 }, { text: 'Mandiri', score: 10 }] },
            { id: 'stairs', question: 'Naik Turun Tangga', options: [{ text: 'Tidak mampu', score: 0 }, { text: 'Butuh bantuan', score: 5 }, { text: 'Mandiri', score: 10 }] },
            { id: 'bathing', question: 'Mandi', options: [{ text: 'Tergantung', score: 0 }, { text: 'Mandiri', score: 5 }] },
        ];
    
    function updatePainValue(sliderId, valueId) {
        const slider = document.getElementById(sliderId), valueDisplay = document.getElementById(valueId);
        const value = parseInt(slider.value, 10); valueDisplay.textContent = value;
        const percentage = value / 10;
        const color1 = [166, 214, 214]; const color2 = [247, 207, 216];
        const r = Math.round(color1[0] + (color2[0] - color1[0]) * percentage);
        const g = Math.round(color1[1] + (color2[1] - color1[1]) * percentage);
        const b = Math.round(color1[2] + (color2[2] - color1[2]) * percentage);
        slider.style.background = `linear-gradient(90deg, rgb(${r},${g},${b}) ${percentage*100}%, #e5e7eb ${percentage*100}%)`;
        valueDisplay.style.color = `rgb(${r},${g},${b})`;
    }

    // --- UGO FISCH WIZARD ---
    function initUgoFischWizard() {
        currentUgoFischStep = 0;
        ugoFischAnswers = new Array(ugoFischItems.length).fill(null);
        renderUgoFischStep(currentUgoFischStep);
    }
    function renderUgoFischStep(stepIndex) {
        const container = document.getElementById('ugoFischWizardContainer');
        const item = ugoFischItems[stepIndex];
        const isLastStep = stepIndex === ugoFischItems.length - 1;
        document.getElementById('ugoFischProgressBar').style.width = `${(stepIndex / ugoFischItems.length) * 100}%`;
        document.getElementById('ugoFischProgressText').textContent = `Langkah ${stepIndex + 1} dari ${ugoFischItems.length}`;
        let optionsHtml = item.options.map((opt) => {
            const isSelected = ugoFischAnswers[stepIndex] === opt.score;
            return `<div class="interactive-option-card ${isSelected ? 'selected' : ''}" onclick="selectUgoFischOption(${stepIndex}, ${opt.score})">
                        <div class="radio-placeholder"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                        <span>${opt.text} (${opt.score}%)</span>
                    </div>`;
        }).join('');
        container.innerHTML = `
            <div class="form-section text-center">
                <h3 class="font-semibold text-xl mb-1">${item.area}</h3>
                <p class="text-slate-600 text-lg mb-6">${item.test}</p>
                <div class="space-y-3 text-left">${optionsHtml}</div>
            </div>
            <div class="flex justify-between items-center mt-8">
                 <button onclick="navigateTo('dashboardPage')" class="btn-nav">
                    <i data-feather="arrow-left" class="w-4 h-4 mr-2"></i>Dashboard
                 </button>
                 <div class="flex gap-4">
                    <button onclick="navigateUgoFischStep('prev')" class="btn-nav ${stepIndex === 0 ? 'invisible' : ''}">Sebelumnya</button>
                    ${isLastStep ? `<button onclick="calculateUgoFisch()" class="btn-primary">Hitung Skor</button>` : `<button onclick="navigateUgoFischStep('next')" class="btn-primary">Berikutnya</button>`}
                 </div>
            </div>`;
        feather.replace();
    }
    function selectUgoFischOption(stepIndex, score) {
        ugoFischAnswers[stepIndex] = score;
        renderUgoFischStep(stepIndex);
        setTimeout(() => { if (currentUgoFischStep < ugoFischItems.length - 1) navigateUgoFischStep('next'); }, 300);
    }
    function navigateUgoFischStep(direction) {
        if (direction === 'next') {
            if (ugoFischAnswers[currentUgoFischStep] === null) { alert('Mohon pilih salah satu opsi.'); return; }
            if (currentUgoFischStep < ugoFischItems.length - 1) { currentUgoFischStep++; renderUgoFischStep(currentUgoFischStep); }
        } else if (direction === 'prev') {
            if (currentUgoFischStep > 0) { currentUgoFischStep--; renderUgoFischStep(currentUgoFischStep); }
        }
    }
    function calculateUgoFisch() {
        if (ugoFischAnswers.includes(null)) { alert('Mohon lengkapi semua pertanyaan.'); return; }
        const totalScore = ugoFischAnswers.reduce((sum, val) => sum + val, 0);
        const averageScore = totalScore / ugoFischItems.length;
        const resultHTML = `<div class="bg-brand-purple/10 p-6 rounded-2xl"><p class="text-slate-600 text-lg">Rata-rata Fungsi Wajah:</p><p class="text-6xl font-extrabold text-brand-purple my-2">${averageScore.toFixed(0)}%</p></div>`;
        const detailsHTML = `<div class="text-xs text-slate-600 space-y-1">${ugoFischItems.map((item, index) => {
            const selectedOption = item.options.find(opt => opt.score === ugoFischAnswers[index]);
            return `<div class="flex justify-between"><span>${item.area} (${item.test}):</span><strong>${selectedOption.text} (${selectedOption.score}%)</strong></div>`;
        }).join('')}</div>`;
        showResult('Hasil Skala Ugo Fisch', resultHTML, 'meh', detailsHTML);
    }

    // --- FADI WIZARD LOGIC ---
    function initFadiWizard(type) {
        document.getElementById('fadiSelectionPage').style.display = 'none';
        document.getElementById('fadiWizardPage').style.display = 'block';
        currentFadiType = type;
        currentFadiStep = 0;
        
        const items = fadiItems.filter(item => type === 'fadi' ? item.type === 'fadi' : item.type === 'sport');
        fadiAnswers = new Array(items.length).fill(null);
        renderFadiStep(currentFadiStep);
    }
    function renderFadiStep(stepIndex) {
        const container = document.getElementById('fadiWizardContainer');
        const items = fadiItems.filter(item => currentFadiType === 'fadi' ? item.type === 'fadi' : item.type === 'sport');
        const item = items[stepIndex];
        const isLastStep = stepIndex === items.length - 1;

        document.getElementById('fadiWizardTitle').textContent = currentFadiType === 'fadi' ? 'Skala FADI' : 'Skala FADI Sport';
        document.getElementById('fadiProgressBar').style.width = `${((stepIndex) / items.length) * 100}%`;
        document.getElementById('fadiProgressText').textContent = `Langkah ${stepIndex + 1} dari ${items.length}`;
        
        let optionsHtml = fadiOptions.map((opt) => {
            const isSelected = fadiAnswers[stepIndex] === opt.score;
            return `
                <div class="interactive-option-card ${isSelected ? 'selected' : ''}" onclick="selectFadiOption(${stepIndex}, ${opt.score})">
                    <div class="radio-placeholder"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                    <span>${opt.text}</span>
                </div>`;
        }).join('');

        container.innerHTML = `
            <div class="form-section text-center">
                <h3 class="text-slate-600 text-lg mb-6">${item.question}</h3>
                <div class="space-y-3 text-left">${optionsHtml}</div>
            </div>
            <div class="flex justify-between items-center mt-8">
                <button onclick="navigateTo('fadiPage')" class="btn-nav">Kembali</button>
                <div class="flex gap-4">
                    <button onclick="navigateFadiStep('prev')" class="btn-nav ${stepIndex === 0 ? 'invisible' : ''}">Sebelumnya</button>
                    ${isLastStep ? 
                        `<button onclick="calculateFADI()" class="btn-primary">Hitung Skor</button>` : 
                        `<button onclick="navigateFadiStep('next')" class="btn-primary">Berikutnya</button>`
                    }
                </div>
            </div>`;
        feather.replace();
    }
    function selectFadiOption(stepIndex, score) {
        fadiAnswers[stepIndex] = score;
        renderFadiStep(stepIndex);
        const items = fadiItems.filter(item => currentFadiType === 'fadi' ? item.type === 'fadi' : item.type === 'sport');
        setTimeout(() => {
            if (currentFadiStep < items.length - 1) navigateFadiStep('next');
        }, 300);
    }
    function navigateFadiStep(direction) {
        const items = fadiItems.filter(item => currentFadiType === 'fadi' ? item.type === 'fadi' : item.type === 'sport');
        if (direction === 'next') {
            if (fadiAnswers[currentFadiStep] === null) { alert('Mohon pilih salah satu opsi.'); return; }
            if (currentFadiStep < items.length - 1) { currentFadiStep++; renderFadiStep(currentFadiStep); }
        } else if (direction === 'prev') {
            if (currentFadiStep > 0) { currentFadiStep--; renderFadiStep(currentFadiStep); }
        }
    }
    function calculateFADI() {
        if (fadiAnswers.includes(null)) { alert('Mohon lengkapi semua pertanyaan.'); return; }
        
        const totalScore = fadiAnswers.reduce((sum, val) => sum + val, 0);
        let maxScore, score, title;
        
        if(currentFadiType === 'fadi') {
            maxScore = 104; // 26 items * 4 points
            score = (totalScore / maxScore) * 100;
            title = 'Hasil Skala FADI';
        } else {
            maxScore = 32; // 8 items * 4 points
            score = (totalScore / maxScore) * 100;
            title = 'Hasil Skala FADI Sport';
        }
        
        const resultHTML = `
            <div class="space-y-4 text-left">
                <div class="flex justify-between items-center bg-brand-teal/50 p-4 rounded-xl">
                    <span class="font-medium text-slate-800">Skor Fungsional</span>
                    <span class="font-bold text-2xl text-slate-800">${score.toFixed(0)}%</span>
                </div>
            </div>`;
        
        const items = fadiItems.filter(item => currentFadiType === 'fadi' ? item.type === 'fadi' : item.type === 'sport');
        const detailsHTML = `<div class="text-xs text-slate-600 space-y-1">${items.map((item, index) => `
                <div class="flex justify-between"><span>${index+1}. ${item.question}</span><strong>Skor: ${fadiAnswers[index]}</strong></div>
            `).join('')}</div>`;

        showResult(title, resultHTML, 'crosshair', detailsHTML);
    }

    // --- SPADI WIZARD LOGIC ---
    function initSpadiWizard() {
        currentSpadiStep = 0;
        spadiAnswers = new Array(spadiItems.length).fill(5); 
        renderSpadiStep(currentSpadiStep);
    }
    function renderSpadiStep(stepIndex) {
        const container = document.getElementById('spadiWizardContainer');
        const item = spadiItems[stepIndex];
        const isLastStep = stepIndex === spadiItems.length - 1;
        
        document.getElementById('spadiProgressBar').style.width = `${((stepIndex) / spadiItems.length) * 100}%`;
        document.getElementById('spadiProgressText').textContent = `Langkah ${stepIndex + 1} dari ${spadiItems.length}`;
        const subscaleTitle = item.type === 'pain' ? 'Sub-skala Nyeri' : 'Sub-skala Disabilitas';

        container.innerHTML = `
            <div class="form-section text-center">
                <p class="font-semibold text-brand-purple mb-2">${subscaleTitle}</p>
                <p class="text-slate-600 text-lg mb-6">${item.question}</p>
                <div class="flex items-center gap-4 max-w-lg mx-auto">
                    <span class="text-3xl font-bold text-brand-purple w-16 text-center" id="spadiValue">${spadiAnswers[stepIndex]}</span>
                    <input type="range" id="spadiSlider" min="0" max="10" value="${spadiAnswers[stepIndex]}" class="w-full dynamic-slider" oninput="updateSpadiValue(${stepIndex})">
                </div>
            </div>
            <div class="flex justify-between items-center mt-8">
                <button onclick="navigateTo('dashboardPage')" class="btn-nav"><i data-feather="home" class="w-4 h-4 mr-2"></i>Dashboard</button>
                <div class="flex gap-4">
                    <button onclick="navigateSpadiStep('prev')" class="btn-nav ${stepIndex === 0 ? 'invisible' : ''}">Sebelumnya</button>
                    ${isLastStep ? `<button onclick="calculateSPADI()" class="btn-primary">Hitung Skor</button>` : `<button onclick="navigateSpadiStep('next')" class="btn-primary">Berikutnya</button>`}
                </div>
            </div>`;
        updatePainValue('spadiSlider', 'spadiValue');
        feather.replace();
    }
    function updateSpadiValue(stepIndex) {
        const value = document.getElementById('spadiSlider').value;
        spadiAnswers[stepIndex] = parseInt(value, 10);
        updatePainValue('spadiSlider', 'spadiValue');
    }
    function navigateSpadiStep(direction) {
        if (direction === 'next' && currentSpadiStep < spadiItems.length - 1) { currentSpadiStep++; renderSpadiStep(currentSpadiStep); }
        else if (direction === 'prev' && currentSpadiStep > 0) { currentSpadiStep--; renderSpadiStep(currentSpadiStep); }
    }
    function calculateSPADI() {
        const painScores = spadiAnswers.slice(0, 5), disabilityScores = spadiAnswers.slice(5);
        const painTotal = painScores.reduce((sum, val) => sum + val, 0), disabilityTotal = disabilityScores.reduce((sum, val) => sum + val, 0);
        const painSubscale = (painTotal / 50) * 100, disabilitySubscale = (disabilityTotal / 80) * 100;
        const totalSpadi = (painSubscale + disabilitySubscale) / 2;
        const resultHTML = `
            <div class="space-y-4 text-left">
                <div class="flex justify-between items-center bg-brand-pink/50 p-4 rounded-xl"><span class="font-medium text-slate-800">Skor Nyeri</span><span class="font-bold text-2xl text-slate-800">${painSubscale.toFixed(1)} / 100</span></div>
                <div class="flex justify-between items-center bg-brand-teal/50 p-4 rounded-xl"><span class="font-medium text-slate-800">Skor Disabilitas</span><span class="font-bold text-2xl text-slate-800">${disabilitySubscale.toFixed(1)} / 100</span></div>
                <div class="flex justify-between items-center bg-brand-purple/20 p-4 rounded-xl border border-brand-purple/50"><span class="font-semibold text-brand-purple">Total Skor SPADI</span><span class="font-extrabold text-3xl text-brand-purple">${totalSpadi.toFixed(1)} / 100</span></div>
            </div>`;
        const detailsHTML = `<div class="text-xs text-slate-600 space-y-1">${spadiItems.map((item, index) => `
            <div class="flex justify-between"><span>${index+1}. ${item.question}</span><strong>Skor: ${spadiAnswers[index]}</strong></div>`).join('')}</div>`;
        showResult('Hasil Skala SPADI', resultHTML, 'shield', detailsHTML);
    }
    
    // --- BARTHEL WIZARD LOGIC ---
    function initBarthelWizard() {
        currentBarthelStep = 0;
        barthelAnswers = new Array(barthelItems.length).fill(null);
        renderBarthelStep(currentBarthelStep);
    }
    function renderBarthelStep(stepIndex) {
        const container = document.getElementById('barthelWizardContainer');
        const item = barthelItems[stepIndex];
        const isLastStep = stepIndex === barthelItems.length - 1;
        const progressPercentage = (stepIndex / barthelItems.length) * 100;
        document.getElementById('barthelProgressBar').style.width = `${progressPercentage}%`;
        document.getElementById('barthelProgressText').textContent = `Langkah ${stepIndex + 1} dari ${barthelItems.length}`;
        let optionsHtml = item.options.map((opt) => {
            const isSelected = barthelAnswers[stepIndex] === opt.score;
            return `<div class="interactive-option-card ${isSelected ? 'selected' : ''}" onclick="selectBarthelOption(${stepIndex}, ${opt.score})">
                        <div class="radio-placeholder"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                        <span>${opt.text} (${opt.score} poin)</span>
                    </div>`;
        }).join('');
        container.innerHTML = `
            <div class="form-section text-center">
                <h3 class="font-semibold text-xl mb-6">${item.question}</h3>
                <div class="space-y-3 text-left">${optionsHtml}</div>
            </div>
            <div class="flex justify-between items-center mt-8">
                 <button onclick="navigateTo('dashboardPage')" class="btn-nav"><i data-feather="home" class="w-4 h-4 mr-2"></i>Dashboard</button>
                 <div class="flex gap-4">
                    <button onclick="navigateBarthelStep('prev')" class="btn-nav ${stepIndex === 0 ? 'invisible' : ''}">Sebelumnya</button>
                    ${isLastStep ? `<button onclick="calculateBarthel()" class="btn-primary">Hitung Skor</button>` : `<button onclick="navigateBarthelStep('next')" class="btn-primary">Berikutnya</button>`}
                 </div>
            </div>`;
        feather.replace();
    }
    function selectBarthelOption(stepIndex, score) {
        barthelAnswers[stepIndex] = score;
        renderBarthelStep(stepIndex);
        setTimeout(() => { if (currentBarthelStep < barthelItems.length - 1) navigateBarthelStep('next'); }, 300);
    }
    function navigateBarthelStep(direction) {
        if (direction === 'next') {
            if (barthelAnswers[currentBarthelStep] === null) { alert('Mohon pilih salah satu opsi.'); return; }
            if (currentBarthelStep < barthelItems.length - 1) { currentBarthelStep++; renderBarthelStep(currentBarthelStep); }
        } else if (direction === 'prev') {
            if (currentBarthelStep > 0) { currentBarthelStep--; renderBarthelStep(currentBarthelStep); }
        }
    }
    function calculateBarthel() {
        if (barthelAnswers.includes(null)) { alert('Mohon lengkapi semua pertanyaan.'); return; }
        const totalScore = barthelAnswers.reduce((sum, val) => sum + val, 0);
        let interpretation = (totalScore <= 20) ? 'Ketergantungan Total' : (totalScore <= 60) ? 'Ketergantungan Berat' : (totalScore <= 90) ? 'Ketergantungan Sedang' : (totalScore <= 99) ? 'Ketergantungan Ringan' : 'Mandiri Penuh';
        const resultHTML = `<div class="bg-brand-purple/10 p-6 rounded-2xl"><p class="text-slate-600 text-lg">Total Skor:</p><p class="text-6xl font-extrabold text-brand-purple my-2">${totalScore}</p><p class="text-slate-600 text-lg">Interpretasi:</p><p class="text-xl font-semibold text-brand-purple">${interpretation}</p></div>`;
        const detailsHTML = `<div class="text-xs text-slate-600 space-y-1">${barthelItems.map((item, index) => {
            const selectedOption = item.options.find(opt => opt.score === barthelAnswers[index]);
            return `<div class="flex justify-between"><span>${index+1}. ${item.question}</span><strong>${selectedOption.text}</strong></div>`
        }).join('')}</div>`;
        showResult('Hasil Indeks Barthel', resultHTML, 'check-square', detailsHTML);
    }
    
    // --- ODI WIZARD LOGIC ---
    function initOdiWizard() {
        currentOdiStep = 0; odiAnswers = new Array(odiItems.length).fill(null);
        renderOdiStep(currentOdiStep);
    }
    function renderOdiStep(stepIndex) {
        const container = document.getElementById('odiWizardContainer');
        const item = odiItems[stepIndex];
        const isLastStep = stepIndex === odiItems.length - 1;
        document.getElementById('odiProgressBar').style.width = `${(stepIndex / odiItems.length) * 100}%`;
        document.getElementById('odiProgressText').textContent = `Langkah ${stepIndex + 1} dari ${odiItems.length}`;
        let optionsHtml = item.options.map((opt, optIndex) => {
            if (opt === '') return '';
            const isSelected = odiAnswers[stepIndex] === optIndex;
            return `<div class="interactive-option-card ${isSelected ? 'selected' : ''}" onclick="selectOdiOption(${stepIndex}, ${optIndex})">
                        <div class="radio-placeholder"><svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div>
                        <span>${opt}</span>
                    </div>`;
        }).join('');
        container.innerHTML = `
            <div class="form-section text-center">
                <h3 class="font-semibold text-xl mb-1">Bagian ${stepIndex + 1}</h3>
                <p class="text-slate-600 text-lg mb-6">${item.question}</p>
                <div class="space-y-3 text-left">${optionsHtml}</div>
            </div>
            <div class="flex justify-between items-center mt-8">
                <button onclick="navigateTo('dashboardPage')" class="btn-nav"><i data-feather="home" class="w-4 h-4 mr-2"></i>Dashboard</button>
                <div class="flex gap-4">
                    <button onclick="navigateOdiStep('prev')" class="btn-nav ${stepIndex === 0 ? 'invisible' : ''}">Sebelumnya</button>
                    ${isLastStep ? `<button onclick="calculateODI()" class="btn-primary">Hitung Skor</button>` : `<button onclick="navigateOdiStep('next')" class="btn-primary">Berikutnya</button>`}
                </div>
            </div>`;
        feather.replace();
    }
    function selectOdiOption(stepIndex, optionIndex) {
        odiAnswers[stepIndex] = optionIndex;
        renderOdiStep(stepIndex);
        setTimeout(() => { if (currentOdiStep < odiItems.length -1) navigateOdiStep('next'); }, 300);
    }
    function navigateOdiStep(direction) {
        if (direction === 'next') {
            if (odiAnswers[currentOdiStep] === null) { alert('Mohon pilih salah satu opsi.'); return; }
            if (currentOdiStep < odiItems.length - 1) { currentOdiStep++; renderOdiStep(currentOdiStep); }
        } else if (direction === 'prev') {
            if (currentOdiStep > 0) { currentOdiStep--; renderOdiStep(currentOdiStep); }
        }
    }
    function calculateODI() {
        if (odiAnswers.includes(null)) { alert('Mohon lengkapi semua pertanyaan.'); return; }
        const totalScore = odiAnswers.reduce((sum, val) => sum + val, 0);
        const answeredCount = odiItems.filter(i => !i.options.every(o=>o==='')).length;
        const maxScore = answeredCount * 5;
        const odiIndex = Math.round((totalScore / maxScore) * 100);
        let interpretation = (odiIndex <= 20) ? 'Disabilitas Minimal' : (odiIndex <= 40) ? 'Disabilitas Sedang' : (odiIndex <= 60) ? 'Disabilitas Berat' : (odiIndex <= 80) ? 'Lumpuh (Crippled)' : 'Terbaring di tempat tidur';
        const resultHTML = `<div class="bg-brand-purple/10 p-6 rounded-2xl"><p class="text-slate-600 text-lg">Skor Disabilitas:</p><p class="text-6xl font-extrabold text-brand-purple my-2">${odiIndex}%</p><p class="text-slate-600 text-lg">Interpretasi:</p><p class="text-xl font-semibold text-brand-purple">${interpretation}</p></div>`;
        const detailsHTML = `<div class="text-xs text-slate-600 space-y-1">${odiItems.map((item, index) => {
            const selectedOption = item.options[odiAnswers[index]];
            return `<div class="flex justify-between"><span>${index+1}. ${item.question}</span><strong>${selectedOption}</strong></div>`
        }).join('')}</div>`;
        showResult('Hasil Skala ODI', resultHTML, 'bar-chart-2', detailsHTML);
    }
    
    // --- ROM LOGIC ---
    function addRomMovement() {
        const joint = document.getElementById('romJoint').value, movement = document.getElementById('romMovement').value, active = document.getElementById('romActive').value, passive = document.getElementById('romPassive').value;
        if (!active && !passive) { alert('Mohon isi nilai ROM Aktif atau Pasif.'); return; }
        romEntries.push({ joint, movement, active: active || 'N/A', passive: passive || 'N/A' });
        renderRomList();
        document.getElementById('romActive').value = ''; document.getElementById('romPassive').value = '';
    }
    function renderRomList() {
        const listContainer = document.getElementById('romList'), emptyState = document.getElementById('romEmptyState');
        if (romEntries.length === 0) { listContainer.innerHTML = ''; emptyState.style.display = 'block'; } 
        else {
            emptyState.style.display = 'none';
            listContainer.innerHTML = romEntries.map((entry) => `<div class="flex items-center justify-between bg-white p-3 rounded-xl shadow-sm"><div><span class="font-semibold text-slate-700">${entry.joint} - ${entry.movement}</span></div><div class="text-right"><span class="text-sm text-slate-500">Aktif: </span><span class="font-medium">${entry.active}°</span><span class="text-sm text-slate-500 ml-4">Pasif: </span><span class="font-medium">${entry.passive}°</span></div></div>`).join('');
        }
    }
    function showRomResult() {
        if (romEntries.length === 0) { alert('Tidak ada data ROM untuk disimpan.'); return; }
        const resultHTML = `<div class="text-center"><p class="text-lg">Total <strong>${romEntries.length}</strong> gerakan dicatat.</p></div>`;
        const detailsHTML = `<div class="text-left bg-slate-50 p-4 rounded-xl space-y-2">${romEntries.map(entry => `<div class="grid grid-cols-3 gap-2 items-center"><span class="font-semibold col-span-1">${entry.joint} ${entry.movement}</span><span class="text-sm text-slate-600 text-center">Aktif: <strong>${entry.active}°</strong></span><span class="text-sm text-slate-600 text-center">Pasif: <strong>${entry.passive}°</strong></span></div>`).join('<hr class="my-1 border-slate-200">')}</div>`;
        showResult('Hasil Pengukuran ROM', resultHTML, 'move', detailsHTML);
    }

    // --- 6MWT LOGIC ---
    let stopwatchInterval, stopwatchTime = 0, stopwatchRunning = false;
    function updateStopwatchDisplay() {
        const time = stopwatchTime, totalSeconds = Math.floor(time / 1000), minutes = Math.floor(totalSeconds / 60), seconds = totalSeconds % 60;
        document.getElementById('stopwatchDisplay').textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }
    function startStopwatch() {
        if (stopwatchRunning) return; 
        stopwatchRunning = true;
        const btn = document.getElementById('startStopBtn');
        const lapBtn = document.getElementById('lapButton');
        lapBtn.disabled = false;
        btn.innerHTML = '<i data-feather="pause" class="mr-2"></i>Berhenti'; feather.replace();
        btn.onclick = stopStopwatch;
        const startTime = Date.now() - stopwatchTime;
        stopwatchInterval = setInterval(() => { 
            stopwatchTime = Date.now() - startTime;
            if (stopwatchTime >= 360000) { // 6 minutes in ms
                stopwatchTime = 360000;
                stopStopwatch();
                btn.disabled = true;
            }
            updateStopwatchDisplay();
        }, 1000);
    }
    function stopStopwatch() {
        if (!stopwatchRunning) return;
        stopwatchRunning = false;
        const btn = document.getElementById('startStopBtn');
        const lapBtn = document.getElementById('lapButton');
        lapBtn.disabled = true;
        btn.innerHTML = '<i data-feather="play" class="mr-2"></i>Lanjut'; feather.replace();
        btn.onclick = startStopwatch;
        clearInterval(stopwatchInterval);
    }
    function resetStopwatch() {
        stopStopwatch(); 
        stopwatchTime = 0; 
        lapCounter = 0;
        updateStopwatchDisplay();
        document.getElementById('lapCount').textContent = lapCounter;
        const btn = document.getElementById('startStopBtn');
        btn.innerHTML = '<i data-feather="play" class="mr-2"></i>Mulai'; feather.replace();
        btn.onclick = startStopwatch;
        btn.disabled = false;
        document.getElementById('lapButton').disabled = true;
        ['distance6MWT', 'rpeStart', 'rpeEnd', 'dyspneaStart', 'dyspneaEnd', 'spo2Start', 'spo2End', 'terminationReason'].forEach(id => {
            const el = document.getElementById(id); if(el) el.value = '';
        });
    }
    function incrementLap() {
        if (!stopwatchRunning) return;
        lapCounter++;
        document.getElementById('lapCount').textContent = lapCounter;
    }

    // --- MODAL & RESULT LOGIC ---
    function showResult(title, bodyHTML, iconName, detailsHTML = '') {
        document.getElementById('resultTitle').textContent = title;
        document.getElementById('resultPatientName').textContent = document.getElementById('patientName').value.trim() || 'Tanpa Nama';
        document.getElementById('resultBody').innerHTML = bodyHTML;
        document.getElementById('resultIcon').innerHTML = `<i data-feather="${iconName}" class="w-16 h-16 text-brand-purple"></i>`; feather.replace({ width: '4rem', height: '4rem', 'stroke-width': 1.5 });
        
        const detailsContainer = document.getElementById('resultDetails');
        const detailsButton = document.getElementById('detailsButton');
        
        if (detailsHTML) {
            detailsContainer.innerHTML = detailsHTML;
            detailsButton.style.display = 'block';
            detailsButton.onclick = () => {
                const isHidden = detailsContainer.style.maxHeight === '0px' || !detailsContainer.style.maxHeight;
                if (isHidden) {
                    detailsContainer.style.maxHeight = `${detailsContainer.scrollHeight}px`;
                    detailsButton.textContent = 'Sembunyikan Rincian';
                } else {
                    detailsContainer.style.maxHeight = '0px';
                    detailsButton.textContent = 'Lihat Rincian';
                }
            };
        } else {
            detailsContainer.innerHTML = '';
            detailsButton.style.display = 'none';
        }
        detailsContainer.style.maxHeight = '0px';
        detailsButton.textContent = 'Lihat Rincian';

        const modal = document.getElementById('resultModal');
        modal.classList.remove('opacity-0', 'pointer-events-none');
        document.getElementById('resultModalContent').classList.remove('scale-95');
    }
    function closeModal() {
        const modal = document.getElementById('resultModal');
        document.getElementById('resultModalContent').classList.add('scale-95');
        modal.classList.add('opacity-0', 'pointer-events-none');
    }
    function showPainResult() {
        const rest = document.getElementById('painRest').value, pressure = document.getElementById('painPressure').value, movement = document.getElementById('painMovement').value;
        const resultHTML = `<p class="text-lg">Skor nyeri telah dicatat.</p>`;
        const detailsHTML = `<div class="space-y-2 text-sm"><div class="flex justify-between items-center"><span>Nyeri Diam:</span> <strong class="text-lg">${rest}/10</strong></div><div class="flex justify-between items-center"><span>Nyeri Tekan:</span> <strong class="text-lg">${pressure}/10</strong></div><div class="flex justify-between items-center"><span>Nyeri Gerak:</span> <strong class="text-lg">${movement}/10</strong></div></div>`;
        showResult('Hasil Pengukuran Nyeri', resultHTML, 'activity', detailsHTML);
    }
    function show6MWTResult() {
        const distance = document.getElementById('distance6MWT').value;
        if (!distance) { alert('Mohon masukkan Jarak Tempuh Aktual.'); return; }
        
        const seconds = Math.floor((stopwatchTime / 1000) % 60), minutes = Math.floor((stopwatchTime / 1000) / 60);
        const timeFormatted = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        
        const resultHTML = `
            <div class="bg-brand-purple/10 p-4 rounded-2xl text-left space-y-2">
                 <div class="flex justify-between items-center">
                    <span class="text-slate-600 font-semibold">Jarak Ditempuh:</span>
                    <span class="font-extrabold text-xl text-brand-purple">${distance} m</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-slate-600">Waktu Tes:</span>
                    <span class="font-bold text-lg text-brand-purple">${timeFormatted}</span>
                </div>
            </div>`;
            
        const rpeStart = document.getElementById('rpeStart').value || 'N/A', rpeEnd = document.getElementById('rpeEnd').value || 'N/A';
        const dyspneaStart = document.getElementById('dyspneaStart').value || 'N/A', dyspneaEnd = document.getElementById('dyspneaEnd').value || 'N/A';
        const spo2Start = document.getElementById('spo2Start').value, spo2End = document.getElementById('spo2End').value;
        const reason = document.getElementById('terminationReason').value;

        const detailsHTML = `
            <div class="text-left text-sm space-y-2">
                <div class="flex justify-between"><span>Jumlah Putaran:</span><strong>${lapCounter}</strong></div>
                <hr class="my-1">
                <div class="flex justify-between"><span>RPE Awal:</span><strong>${rpeStart}</strong></div>
                <div class="flex justify-between"><span>RPE Akhir:</span><strong>${rpeEnd}</strong></div>
                <hr class="my-1">
                <div class="flex justify-between"><span>Sesak Awal:</span><strong>${dyspneaStart}</strong></div>
                <div class="flex justify-between"><span>Sesak Akhir:</span><strong>${dyspneaEnd}</strong></div>
                ${(spo2Start || spo2End) ? `
                <hr class="my-1">
                <div class="flex justify-between"><span>SpO2 Awal:</span><strong>${spo2Start || 'N/A'}%</strong></div>
                <div class="flex justify-between"><span>SpO2 Akhir:</span><strong>${spo2End || 'N/A'}%</strong></div>
                ` : ''}
                ${reason ? `<hr class="my-1"><div class="flex flex-col"><span class="text-slate-500">Alasan Berhenti:</span><strong class="mt-1">${reason}</strong></div>` : ''}
            </div>`;
        showResult('Hasil 6-Minute Walk Test', resultHTML, 'watch', detailsHTML);
    }

    // --- INISIALISASI ---
    document.addEventListener('DOMContentLoaded', () => {
        navigateTo('dashboardPage');
    });
    </script>
</body>
</html>
